# inpt = "                                           I     U       O   M           N     O       S
#                                            X     T       X   C           D     N       A
#   #########################################.#####.#######.###.###########.#####.#######.#######################################
#   #.....#.......#.....#.....#.....#...#.#...#...#...#.....#.#...........#.....#.....#.............#.#...#...#...#.......#.....#
#   #####.#######.#####.#####.#.###.###.#.#.###.#.###.#.#.###.###.###.#####.#.#######.#####.#.#######.###.#.###.###.#######.#####
#   #.#.#...#...#.....#.........#...........#.#.#...#.#.#.....#...#.......#.#...#.#.....#.#.#...............#.........#.........#
#   #.#.###.###.###.#####.#######.#####.#.###.#.###.#.#.#########.#.#########.###.#.#####.###.###.#####.#.#####.###.#########.###
#   #.....#.........#.....#...#.#.....#.#.....#.#...#.#.#...#...#.#.....#...#.#.#.........#.....#.....#.#.........#.#...#...#...#
#   #####.#####.#.#.###.#####.#.#.#####.#.#.#.#.###.#.#.###.###.#####.#####.#.#.#####.#######.###.#.#.#######.###.#####.###.#.###
#   #...#.......#.#.......#.......#.#.#.#.#.#.#...#.#.#.......#.#.#.....#.........#.....#.....#.#.#.#.......#.#.........#.......#
#   #.###############.#####.#####.#.#.#######.###.#.#.###.#.###.#.#.#.###.###.#####.#######.#.#.###.#.###.#.#.###.#####.#####.#.#
#   #...#.#.#...#.......#.......#...#.....#...#...#.#.#...#.....#...#...#.#...#.......#...#.#.....#.#...#.#.#.#.#.#.....#.#.#.#.#
#   #.###.#.#.#######.#.#.#.#####.###.###.#.#.#.###.#.#.###.#.###.###########.#####.#####.###.#.#.#.#.#########.###.#####.#.#.###
#   #.#.......#...#...#.#.#...#...#.#.#.....#.#...#...#.#...#.#.......#.#.#.#.#.........#.....#.#.#.#...........#.#...#.#.#.#...#
#   #.###.###.#.#####.###.#.###.###.###.#####.###.#.#.#.#############.#.#.#.#.#######.#.###.#.#####.#.#.#####.#.#.#####.#.#.#.###
#   #.#...#...#.#.#.#...#.#...#.#.....#.#.....#...#.#.#...#.#.#...........#.....#.....#.#...#.....#.#.#.....#.#.....#...#.#.#.#.#
#   #.#######.#.#.#.#.#############.#####.###.#.#######.#.#.#.#.###.#.#####.#########.#####.#################.#######.#.#.#.#.#.#
#   #.....#.......#.#.#...#...#...#...#.#.#...#.....#...#.#.....#.#.#.#.......#.#.#...#.......#.#...#.#.....#.....#.#.#.....#...#
#   ###.#########.#.###.#####.#.###.###.###.#.#.#######.###.###.#.#######.###.#.#.#.#.#.#####.#.#.###.#.#.#####.###.#######.#.###
#   #.#.....#.#...#...#...#.#.#...#...#...#.#.#.....#...#...#.......#...#.#.......#.#.#.#.........#.....#...#.#.#.#...#.........#
#   #.###.###.###.###.#.###.#.###.#.#####.###.#.#.###.#.#########.###.#.#####.#######.###.###.#####.#.#.#####.###.###.#######.###
#   #.........#.#...#.#.#...........#.#.......#.#...#.#.#...#.........#.#.....#.#.......#.#.#.#.#...#.#.#.....#.#...#.#.....#...#
#   ###.#.#####.#.###.#.#####.#####.#.#######.#.###.###.#.#####.#.#.#########.#.#####.#####.#.#.#.#.#######.###.#.###.#.#.###.###
#   #.#.#.#...#.........#.#.#.#.#.#...#.#.....#.#.#.#.......#.#.#.#.#...........#.#.......#.....#.#.#.#...#...#...#.....#...#.#.#
#   #.#.#####.#.###.###.#.#.###.#.#.#.#.#####.#.#.#.###.#.###.#####.#####.#######.###.#######.###.#.#.#.###.#####.###.#.###.#.#.#
#   #...#.#.#.#.#.#.#.....#.........#.#...#...#...#.#...#.#...#.......#...#...#...........#.#.....#.#...#.#.#...#...#.#.#.......#
#   ###.#.#.#.###.#####.#.#####.#.#.###.###.#.#.#.#####.#####.#.#.#.#.#.###.#.#.###.#.#.###.#.#.#####.###.#.###.#.#.#########.###
#   #...#.#...#...#.#.#.#.......#.#.........#.#.#.#...........#.#.#.#.#.#...#.#...#.#.#.#.#.#.#.#.............#.#.#.#.....#.#.#.#
#   ###.#.#.###.###.#.###.#.#.#####.###.#####.#.#######.#############.#.#.###.###.#######.#.#.###.###.#.#######.#.#######.#.#.#.#
#   #.#.....#.#.#.#.#.....#.#.#.#...#.......#.#...#...........#...#...#...#...#...#...#...........#...#.#.#...#.....#...#.#.....#
#   #.#####.#.#.#.#.#########.#.#.#.#.#.###.###.#######.#######.###.###.###.#.###.#.#####.###.#.#########.#.###.#######.#.###.###
#   #...#.....#.#.#.#.#.#...#.#...#.#.#.#.#...#.......#.........#.....#.#...#.#.....#.#.#...#.#.#.#...#.....#.....#.#...#.#.....#
#   #.#######.#.#.#.#.#.#.###.#.#.#.#.###.###.#.#.#####.#.###.#####.#######.###.#.###.#.#.#.#.#.#.###.###.#####.#.#.#.###.#.#####
#   #...#.#...#...........#...#.#.#.#.#.......#.#...#...#.#...#.......#.......#.#...#.....#.#.#...#.......#...#.#.......#.....#.#
#   #.#.#.###.###.###.#############.#########.###.#########.#####.#######.#####.#######.#################.#.#######.#####.###.#.#
#   #.#.....#.#.#.#.#.....#.#.....#.#        C   S         P     R       W     B       A        #...#.#...#...#.#.....#...#...#.#
#   ###.#.###.#.#.#.#######.###.###.#        S   A         P     D       A     E       D        #.###.###.#.###.#.###########.#.#
#   #...#.#...........#...#.....#...#                                                           #.#.......#.........#.#.#.....#.#
#   ###.#####.#####.###.###.###.#####                                                           #.#####.#.#.#.#.#.###.#.###.#.#.#
#   #...#.#...#.........#.....#.#...#                                                           #.....#.#...#.#.#.#.#.......#...#
#   ###.#.###.#.###########.#####.###                                                           #.#.#.#.###.###.#.#.#######.#.#.#
# EY........#.#...#...#.#.......#.#.#                                                           #.#.#.#...#.#.#.#...#.......#.#.#
#   #.###.#.#.#.#.#.#.#.###.#####.#.#                                                           #.#.#####.###.###.#####.#.###.###
#   #.#...#...#.#...#................RB                                                       VN..#.......#.....#.......#.#......CS
#   #############.#########.#.#######                                                           #############.#.###.#######.###.#
#   #...#.#...#.....#.#.#...#.#.....#                                                           #.........#...#.#...#.#...#...#.#
#   #.###.###.###.###.#.###.#####.#.#                                                           ###.###.###.#.#######.#.#########
# BE....#...#...#.#.......#.#.#...#.#                                                         ON..#.#...#...#.#...#...#.#.#...#.#
#   #.#####.###.#######.#####.###.#.#                                                           #.#.#.#####.#.#.#####.#.#.#.###.#
#   #.#.#.......#.........#.....#.#.#                                                           #.#.#.#...#.#.#.#.........#.#.#..MR
#   #.#.#.#####.#####.#.#.###.###.#.#                                                           #.#.#.#####.#.#.###.#.#####.#.#.#
#   #.....#...#.......#.#.........#..QG                                                       WP....#.......#.......#............VN
#   #######.###.###.###.#############                                                           ###.###########.#.#######.#######
# ZM........#.....#...#.#...#.....#.#                                                           #.#...#...#...#.#.#.....#.#.....#
#   #.#.#########.#.#####.#######.#.#                                                           #.#####.#.###.#######.#.###.#.###
#   #.#.......#.#.#.....#.#.....#....ND                                                       UE........#...........#.#.#...#...#
#   ###.#######.#########.###.#.#.###                                                           #.###.#.#.#####.###.#.#.###.#.###
#   #...#...#...#...#.......#.#.....#                                                           #.#.#.#.#...#...#...#.#.....#....GN
#   #.#####.###.#.###.###.#####.#.###                                                           #.#.###########.#.###.#####.#.#.#
#   #...................#.......#...#                                                           #.#.......#.#.#.#.......#...#.#.#
#   #####.#####.###.#.#####.#########                                                           ###.#.#.###.#.###.###############
#   #...#.....#.#...#.#...#.#.#.....#                                                         UT....#.#.#.#.#...#.#.#.......#....WA
#   #.#.###############.###.#.#.#####                                                           ###.#####.#.#.###.#.#.###.#.#.#.#
# WP..#...#.....#.#.#.....#.#.......#                                                           #.....#.....#.#.....#.#...#...#.#
#   #.#.#.###.###.#.###.#.###.#.#####                                                           #.#.#.###.###.#########.###.#.###
#   #.#.#.....#.....#.#.#.....#.....#                                                           #.#.#.#.......#.#.#.....#...#.#.#
#   #######.#.#.#.###.#.#.#.#.#######                                                           #.#####.###.#.#.#.#####.###.#.#.#
#   #...#.#.#...#.......#.#.#........OX                                                         #.........#.#...........#...#.#.#
#   #.###.###########.###.###.#.###.#                                                           #.#######.#####.###########.###.#
#   #.......#.....#...#...#...#.#...#                                                           #.#.....#.#.#.#.#.......#...#....PP
#   #.###.#.###.#.###################                                                           ###.###.###.#.###.#.###.#####.###
# zO..#...#.#...#.#.#.....#...#.....#                                                         ZR..#.#.#...#.....#.#.#.....#.....#
#   ###.#####.###.#.#.#####.###.###.#                                                           #.#.#.#.#####.#####.###.#####.#.#
#   #...#...#...#.....#.#.........#..FK                                                         #.....#.....#.#...#.#...#...#.#.#
#   #.###.#.###.#####.#.###.#.#.#.#.#                                                           #.###.###.###.###.#.###.#.#.###.#
# ZZ......#.......#.#.......#.#.#.#.#                                                           #.#...#.............#.....#.....#
#   #.###.###.#.###.###.#############                                                           ###.#####.###.#################.#
#   #.#...#.#.#.......#.#.#.........#                                                           #.....#.....#.#...............#.#
#   #######.#####.#.#.###.#.###.###.#                                                           #########.#####.###.#######.#####
# RX..#.#.#.....#.#.#.#.#.....#.#....GN                                                         #.#...#...#.....#.....#.#........UE
#   #.#.#.#.#.#########.###.#.###.#.#                                                           #.#.#####.###.#.###.###.###.###.#
#   #.....#.#.....#.#.....#.#...#.#.#                                                         ZM....#...#.#...#.#.#.......#...#.#
#   #.#.#.#.#.#####.###.#####.#.#.#.#                                                           #.#.###.###.#.###.#.#.#####.###.#
#   #.#.#...#.................#.#.#.#                                                           #.#.........#...#...#...#.....#.#
#   #.###.#.#####.###.#.#####.#####.#    M       P           I     R     E     z           M    #.###.#.#.###.#######.#####.###.#
#   #.#...#.....#...#.#...#.#...#.#.#    C       G           X     X     Y     O           R    #...#.#.#.#...#.....#.....#...#.#
#   #####.###.###.#.#.#####.#.###.#######.#######.###########.#####.#####.#####.###########.#########.#######.#.#####.#.#.###.###
#   #.#.#...#.#...#.#.#.............#.....#.#.#...#...#.........#...#.......#.......#.#...#.#.......#.#.............#.#.#.#.#...#
#   #.#.#.#.#.###.###.###.###.###.###.#.#.#.#.###.#.#.###.#########.#######.#######.#.###.#.###.#.#####.###.#.###.#########.#####
#   #...#.#.#...#...#...#...#...#.#...#.#...#.#.....#.#...#.....#...#.#.#.#.....#.#.#.#.#.#.....#.#...#...#.#.#.............#...#
#   ###.#.#######.#.#####.###.#.#####.#.###.#.#######.#.###.#.###.#.#.#.#.###.###.#.#.#.#.#.#######.#######.#####.###.#######.###
#   #.......#.....#.#.......#.#...#...#.#.....#...#.#.#.....#...#.#.#...........#.#...#...#...........#.#.#...#.....#...........#
#   #.#.#.#.#.#.#.#.#.#.#.#.###.#.###.#.#.###.###.#.#.#######.#####.###.###.#.###.#.###.#.#.#.###.#.#.#.#.#.###.#.###.###.###.###
#   #.#.#.#.#.#.#.#.#.#.#.#.#...#...#.#.#.#.#.#.#.........#...#.#...#.....#.#...#...#...#...#...#.#.#.#.#...#...#.#.....#.#.#...#
#   ###.#.#####.#######.#.###.###.###.#####.#.#.#.#####.#####.#.###.#####.#.#.#####.#.#.###.#######.#.#.#.#######.#######.#.#####
#   #...#...#...#.#.#...#...#.#.#...#.#.......#...#.#...#.....#.....#.....#.#...#...#.#.#.........#.#.#...#.........#...........#
#   ###.#####.###.#.#.#.#######.#.#########.#.#.###.#.#####.#.#.#.#####.#####.#####.#.#########.#########.#####.#.###.#####.###.#
#   #.....#.....#.....#.......#.....#.......#.#.....#...#...#.#.#.....#.#.#.#.#...#.#.......#...........#.#.#.#.#...#...#.....#.#
#   ###.#.###.#######.###.###.###.###.###.###.#.#.###.###.###.#######.#.#.#.#####.#.#.#.#########.###.#.#.#.#.#####.#.#.#.#.#.#.#
#   #...#...#...#.#.....#.#.....#.#...#.#.#...#.#...#.#.#.#.#.#.#...#.#.....#.#...#.#.#.........#.#.#.#.#.........#.#.#.#.#.#.#.#
#   #.###.#.###.#.#.#.#.#####.#########.#####.#.#######.###.#.#.###.#.#.###.#.###.#.#####.#######.#.#######.#.#########.###.#.#.#
#   #.#...#.#...#...#.#.#.......#...#.#.......#.#.......#...#...#...#.#...#.#.#.......#...#.#.#.#...#.....#.#.#.#...#.....#.#.#.#
#   #.#.#.#.#####.#.#.#####.#####.###.#.#####.#.###.#######.#.#####.#.#####.#.###.#######.#.#.#.###.#.#####.###.#.#####.#.#######
#   #.#.#.#...#...#.#.#.......#.#.#.#.#.#.#.#.#.#...#.#.#...#...#.#.......#.....#...#...........#.#...#.#.....#...#...#.#...#.#.#
#   ###.###.#.#.#########.#####.#.#.#.###.#.#.#.###.#.#.###.#.###.#.###.#.###.###.#####.###.#####.#####.#.#.###.#####.###.###.#.#
#   #.....#.#.#.#.........#.......#.#...#.....#.....#.....#...#.......#.#...#.#.......#...#.......#.....#.#...#...#.....#.#.#...#
#   #.#.###.#.#.#.###.#.#######.#.#.#.#####.#.#.###.###.#.#.#####.#.#####.###.###.#########.###.#.###.#####.###.###.#.#####.#.###
#   #.#...#.#.#.#.#.#.#...#.....#.........#.#.#.#.....#.#.#...#.#.#...#.#.#.#.#.......#.......#.#...#...#.#.........#...........#
#   #.#.###.#######.#.#.#####.#########.#####.#######.#.#.#.###.###.#.#.###.#.#####.#######.#########.###.#.###.#.#.###.#.#.###.#
#   #.#.#.......#...#.#.#.#...#...#.....#.#...#.......#.#.......#...#.#.........#...#...............#.#.#.#.#.#.#.#...#.#.#.#.#.#
#   #.#####.#######.#####.#######.#.###.#.###.#.#######.###########.#.#.###########.#####.###.###.###.#.#.###.###.#.#####.###.###
#   #.#.....#...............#.......#.....#...#.......#...#...#...#.#.#...#.......#.....#...#...#...#.......#...#.#.....#.#...#.#
#   #.#.###.#.#.#.#.#######.#.#.#.#######.###.#######.###.###.#.#.###.###.#####.#.#.#.###.###########.###.###.#####.#.#####.###.#
#   #.#.#...#.#.#.#.#.#.......#.#...#.........#.........#...#.#.#...#.#.#...#.#.#...#.#.......#.........#.........#.#.#...#...#.#
#   #.#.###.###.#####.#.#####.#.#####.###.#.###.#.#######.###.###.#.#.#.###.#.#.###.#####.#.###.#####.#.#.###.#####.#####.#.###.#
#   #.#.#.#.#...#...#...#.....#.#.....#...#.#.#.#...#...#...#.#...#...#.......#...#.....#.#.......#.#.#.#.#.....#.#.............#
#   #####.#.#.#.#.#.###.#.###.#####.#####.###.#.###.#.#.#.###.#.#######.###.#####.#######.#.#.#.###.#.#.###.#####.###.#.#.###.#.#
#   #.......#.#.#.#.....#.#.....#...#.......#.....#.#.#.......#.......#...#.#...........#.#.#.#.....#.#.#...........#.#.#...#.#.#
#   #####################################.#######.#########.#.#######.#.###########.#######.#####################################
#                                        Z       A         R A       F Q           R       P
#                                        R       D         B A       K G           D       G                                       "

inpt = "                   A
                   A
  #################.#############
  #.#...#...................#.#.#
  #.#.#.###.###.###.#########.#.#
  #.#.#.......#...#.....#.#.#...#
  #.#########.###.#####.#.#.###.#
  #.............#.#.....#.......#
  ###.###########.###.#####.#.#.#
  #.....#        A   C    #.#.#.#
  #######        S   P    #####.#
  #.#...#                 #......VT
  #.#.#.#                 #.#####
  #...#.#               YN....#.#
  #.###.#                 #####.#
DI....#.#                 #.....#
  #####.#                 #.###.#
ZZ......#               QG....#..AS
  ###.###                 #######
JO..#.#.#                 #.....#
  #.#.#.#                 ###.#.#
  #...#..DI             BU....#..LF
  #####.#                 #.#####
YN......#               VT..#....QG
  #.###.#                 #.###.#
  #.#...#                 #.....#
  ###.###    J L     J    #.#.###
  #.....#    O F     P    #.#...#
  #.###.#####.#.#####.#####.###.#
  #...#.#.#...#.....#.....#.#...#
  #.#####.###.###.#.#.#########.#
  #...#.#.....#...#.#.#.#.....#.#
  #.###.#####.###.###.#.#.#######
  #.#.........#...#.............#
  #########.###.###.#############
           B   J   C
           U   P   P               "

# inpt = "         A
#          A
#   #######.#########
#   #######.........#
#   #######.#######.#
#   #######.#######.#
#   #######.#######.#
#   #####  B    ###.#
# BC...##  C    ###.#
#   ##.##       ###.#
#   ##...DE  F  ###.#
#   #####    G  ###.#
#   #########.#####.#
# DE..#######...###.#
#   #.#########.###.#
# FG..#########.....#
#   ###########.#####
#              Z
#              Z       "

mutable struct portal
    Eingang::Tuple
    Ausgang::Tuple
    lable::String
end

function getOtherEnd(x, y, portals)
    for p = portals
        if (x, y) == p.eingang
            return p.ausgang
        elseif (x, y) == p.ausgang
            return p.eingang
        end
    end
end

function isChar(c::String)
    return c != " " && c != "#" && c != "."
end

function getPossibleSteps((x, y), maze, portals)
    tmp::Vector{Tuple} = []
    maze[x+1, y] == "." && push!(tmp, (x+1, y))
    maze[x, y+1] == "." && push!(tmp, (x, y+1))
    maze[x-1, y] == "." && push!(tmp, (x-1, y))
    maze[x, y-1] == "." && push!(tmp, (x, y-1))
    otherEnd = getOtherEnd(x, y, portals)
    # println(typeof(otherEnd))
    isChar(maze[x+1, y]) && typeof(otherEnd) != Nothing && push!(tmp, otherEnd)
    isChar(maze[x, y+1]) && typeof(otherEnd) != Nothing && push!(tmp, otherEnd)
    isChar(maze[x-1, y]) && typeof(otherEnd) != Nothing && push!(tmp, otherEnd)
    isChar(maze[x, y-1]) && typeof(otherEnd) != Nothing && push!(tmp, otherEnd)
    return tmp
end

function getOtherEnd(x, y, portals)
    # println((x, y))
    for p = portals
        if p.lable != "AA"
            if p.Eingang == (x, y) && p.lable == "ZZ"
                return (Inf, Inf)
            end
            if p.Eingang == (x, y)
                # println(p)
                return p.Ausgang
            elseif p.Ausgang == (x, y)
                # println(p)
                return p.Eingang
            end
        end
    end
end

function search(Maze, portals, possiblePlaces)
    step = -1
    finished = false
    while !finished
        printMaze(Maze)
        # sleep(0.2)
        tmp = []
        for i = possiblePlaces
            if i == (Inf, Inf)
                println("Destination found after $step Steps")
                finished = true
                break
            end
            Maze[i[1], i[2]] = "#"
            append!(tmp, getPossibleSteps(i, Maze, portals))
        end
        # println("Step made")
        step += 1
        possiblePlaces = tmp
        # println(length(tmp))
    end
end

function printMaze(Maze)
    toPrint = ""
    for r = eachrow(Maze)
        tmp = ""
        for c = r
            tmp *= c
        end
        toPrint *= tmp * "\n"
    end
    print(toPrint)
end

# Maze = Matrix{String}(undef, 131, 123)
Maze = Matrix{String}(undef, 40, 40)

y = 2
for l = split(inpt, "\n")
    x = 2
    for t = split(l, "")
        global Maze[x, y] = t
        x += 1
    end
    global y += 1
end

for i = eachindex(Maze)
    if !isassigned(Maze, i)
        Maze[i] = " "
    end
end

portals = []
for x = 1:size(Maze, 1)
    for y = 1:size(Maze, 2)
        if isChar(Maze[x, y])
            if isChar(Maze[x+1, y])
                found = false
                for p = portals
                    if p.lable == Maze[x, y] * Maze[x+1, y] || p.lable == Maze[x+1, y] * Maze[x, y]
                        p.Ausgang = Maze[x+2, y] == "." ? (x+2, y) : (x-1, y)
                        found = true
                    end
                end
                !found && push!(portals, portal(Maze[x+2, y] == "." ? (x+2, y) : (x-1, y), (1, 1), Maze[x, y] * Maze[x+1, y]))
            elseif isChar(Maze[x, y+1])
                found = false
                for p = portals
                    if p.lable == Maze[x, y] * Maze[x, y+1] || p.lable == Maze[x, y+1] * Maze[x, y]
                        p.Ausgang = Maze[x, y+2] == "." ? (x, y+2) : (x, y-1)
                        found = true
                    end
                end
                !found && push!(portals, portal(Maze[x, y+2] == "." ? (x, y+2) : (x, y-1), (1, 1), Maze[x, y] * Maze[x, y+1]))
            end
        end
    end
end


# printMaze(Maze)

println(portals)
printMaze(Maze)

for p = portals
    if p.lable == "AA"
        search(Maze, portals, [p.Eingang])
    end
end
